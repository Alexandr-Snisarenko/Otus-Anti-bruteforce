# Anti‚ÄëBruteforce ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∞ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `docs/architecture/`. –í—Å–µ —Å—Ö–µ–º—ã —Å–¥–µ–ª–∞–Ω—ã –≤ PlantUML –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ `.svg` –∏–ª–∏ `.png`.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ `docs/architecture/`

```
docs/
‚îú‚îÄ‚îÄ architecture/
‚îÇ   ‚îú‚îÄ‚îÄ anti-bruteforce-components.puml   # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è —Å—Ö–µ–º–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ anti-bruteforce-deployment.puml   # –°—Ö–µ–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (docker/k8s)
‚îÇ   ‚îú‚îÄ‚îÄ anti-bruteforce-classes.puml      # –ö–ª–∞—Å—Å—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (core/app)
‚îÇ   ‚îú‚îÄ‚îÄ anti-bruteforce-sequence.puml     # –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å CheckAttempt
‚îÇ   ‚îî‚îÄ‚îÄ README.md                         # –¢–µ–∫—É—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
```

---

## üß© 1. Component Diagram ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞

![](./anti-bruteforce-components.svg)

**–û–ø–∏—Å–∞–Ω–∏–µ:**

* `Transport (gRPC/HTTP)` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ API.
* `ApplicationService` ‚Äî —Ñ–∞—Å–∞–¥ –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∏.
* `RateLimiter` ‚Äî —è–¥—Ä–æ, —Ä–µ–∞–ª–∏–∑—É—é—â–µ–µ –∞–ª–≥–æ—Ä–∏—Ç–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (Sliding Window / Leak Bucket).
* `CIDR Matcher` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ IP –ø–æ –±–µ–ª–æ–º—É/—á—ë—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫–∞–º.
* `Redis` ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—á—ë—Ç—á–∏–∫–æ–≤ (buckets), pub/sub –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤.
* `PostgreSQL` ‚Äî —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –±–µ–ª—ã—Ö/—á—ë—Ä–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤.

---

## üèóÔ∏è 2. Deployment Diagram ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ

![](./anti-bruteforce-deployment.svg)

**–û–ø–∏—Å–∞–Ω–∏–µ:**

* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `anti-bruteforce` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–¥–ø–∏—Å—á–∏–∫ pub/sub.
* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å `redis` –∏ `postgres`.
* –ö–ª–∏–µ–Ω—Ç—ã: `Auth Service` (—Å–µ—Ä–≤–µ—Ä‚Äë—Å–µ—Ä–≤–µ—Ä API) –∏ `Admin CLI`.

---

## üß± 3. Class/Interface Diagram ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏

![](./anti-bruteforce-classes.svg)

**–ö–ª—é—á–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**

* `RateLimiter` ‚Äî –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã `Allow()` –∏ `Reset()`.
* `BucketStore` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å Redis.
* `ListStore` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL.
* `CidrMatcher` ‚Äî –∫–µ—à –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ IP.
* `ApplicationService` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –±–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫—É.

---

## üîÅ 4. Sequence Diagram ‚Äî —Å—Ü–µ–Ω–∞—Ä–∏–π CheckAttempt

![](./anti-bruteforce-sequence.svg)

**–ü–æ—Ä—è–¥–æ–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π:**

1. –ö–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `CheckAttempt`.
2. –°–µ—Ä–≤–∏—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç IP –≤ —Å–ø–∏—Å–∫–∞—Ö (—á–µ—Ä–µ–∑ `CidrMatcher`).
3. –ï—Å–ª–∏ IP –Ω–µ –≤ —Å–ø–∏—Å–∫–∞—Ö ‚Äî –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `RateLimiter`.
4. –õ–∏–º–∏—Ç–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—á—ë—Ç—á–∏–∫–∏ –≤ Redis –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ.
5. –û—Ç–≤–µ—Ç —É—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç—É.

---

## üìú –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

* –í—Å–µ —Å—Ö–µ–º—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –¢–ó: –ª–∏–º–∏—Ç—ã N/M/K, —Å–ø–∏—Å–∫–∏ CIDR, pub/sub –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
* –ú–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `.svg` –∏–∑ `.puml` —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:

  ```bash
  make docs
  ```
* –°—Ö–µ–º—ã —Å–ª–µ–¥—É–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º, –æ–±–Ω–æ–≤–ª—è—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
